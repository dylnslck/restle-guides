<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Restle Guides</title>
    <link rel="stylesheet" href="css/libs.css">
    <link rel="stylesheet" href="css/main.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,800' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div class="banner"></div>
    <div class="container">
      <div class="row">
        <section class="intro p-t-3 p-x-3">
          <h1>Restle Guides <span class="text-muted">v0.0.1-alpha.1</span></h1>
          <p>
            <a href="https://travis-ci.org/dylnslck/restle" target="_blank">
              <img src="https://travis-ci.org/dylnslck/restle.svg"/>
            </a>
            <a href="http://badge.fury.io/js/restle" target="_blank">
              <img src="https://badge.fury.io/js/restle.svg"/>
            </a>
          </p>
          <p>
            Restle is a simple Node.js <a href="http://jsonapi.org" target="_blank">JSON API</a>
            engine implementation. This library aims to be easy to use by requiring virtually
            no boilerplate while still maintaining flexible application logic customization.
            This software is very new, buggy, and a work in progress. Send me an email at
            <a href="mailto:dylan@directly.io">dylan@directly.io</a>
            if you need some help or run into an error or feel free to open an issue on
            <a href="https://github.com/dylnslck/restle" target="_blank">GitHub</a>.
          </p>
        </section>

        <section class="start p-t-1 p-x-3">
          <h3>Getting started</h3>
          <p>
            Restle doesn't follow any MVC patterns and is unopiniated. The library manages
            data objects and the relationships between them and exposes them to the routes
            defined in the JSON API specification. Restle comes with an in-memory
            adapter baked in and currently supports <a href="https://github.com/dylnslck/restle-mongodb">MongoDB</a>,
            but more database adapters are under construction.
          </p>
          <pre><code class="language-javascript">// Create a very basic application.
const Restle = require(&#39;restle&#39;);

const app = new Restle({
  namespace: &#39;api&#39;,
  port: 3000,
});

app.on(&#39;ready&#39;, () =&gt; console.log(`Restle is listening at port ${app.port}`));
</code></pre>
          <p>
            The above app doesn't anything. In order for your data to be exposed over HTTP,
            you must add some schemas. Create a file called schemas.js.
          </p>
          <pre><code class="language-javascript">const blog = {
  attributes: {
    &#39;title&#39;: { type: &#39;string&#39; },
    &#39;content&#39;: { type: &#39;string&#39; },
    &#39;published-on&#39;: { type: &#39;date&#39; },
  },
  relationships: {
    &#39;author&#39;: { type: &#39;user&#39;, isMany: false },
    &#39;comments&#39;: { type: &#39;comment&#39;, isMany: true },
  },
};

const comment = {
  attributes: {
    &#39;content&#39;: { type: &#39;string&#39; },
    &#39;published-on&#39;: { type: &#39;date&#39; },
  },
  relationships: {
    &#39;author&#39;: { type: &#39;user&#39;, isMany: false },
  },
};

const user = {
  attributes: {
    &#39;name&#39;: { type: &#39;string&#39; },
    &#39;password&#39;: { type: &#39;string&#39; },
    &#39;email&#39;: { type: &#39;string&#39; },
  },
}

const schemas = { blog, comment, user };

module.exports = schemas;
</code></pre>
          <p>
            Then register those schemas with your Restle instance.
          </p>
          <pre><code class="language-javascript">const Restle = require(&#39;restle&#39;);
const schemas = require(&#39;./schemas&#39;);

const app = new Restle({
  namespace: &#39;api&#39;,
  port: 3000,
});

app.register(schemas);
app.on(&#39;ready&#39;, () =&gt; console.log(`Restle is listening at port ${app.port}`));
</code></pre>
          <p>You can now manipulate users, comments, and blogs via the proper JSON API routes.</p>
        </section>

        <section class="events p-t-1 p-x-3">
          <h3>Events</h3>
          <p>
            Restle comes with 'before' and 'after' events - the 'before' event is fired when
            there has been an HTTP request but before the database is accessed. For example,
            you can intercept a POST request and modify some data before that request touches
            the database. You can intercept all requests to your app or you can intercept a single resource request (or both).
            The 'req', 'res', and 'next' arguments are <a href="http://expressjs.com/" target="_blank">Express</a>
            objects. To reject the request, simply do not return next().
          </p>
          <pre><code class="language-javascript">const bcrypt = require(&#39;bcrypt&#39;);
const jwt = require(&#39;jsonwebtoken&#39;);

// This function fires before all requests to your app. This is a good place to
// perform auth checks, etc.
app.before(function(req, res, next) {
  const token = req.get(&#39;authorization&#39;);
  const secret = new Buffer(process.env.SECRET_KEY, &#39;base64&#39;);

  jwt.verify(token, secret, (err, decoded) =&gt; {
    return err ? res.sendStatus(403) : next();
  });
});

// This function fires before a user is created, i.e. a POST request to /api/users.
app.before(&#39;user.create&#39;, function(req, res, next) {
  const numRounds = 10;
  const password = req.body.data.attributes.password;

  bcrypt.hash(password, numRounds, (err, hash) =&gt; {
    if (err)
      return res.status(500).json(err);

    req.body.data.attributes.password = hash;
    return next();
  });
});
</code></pre>
          <p>
            After registering your schemas, Restle automatically generates events at your disposal. For example,
            app.before('user.create'), app.before('user.update'), app.before('user.find'), and app.before('user.findOne').
          </p>
        </section>
      </div>
    </div>

    <script src="js/libs.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>
